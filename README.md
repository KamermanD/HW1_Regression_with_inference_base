**Проект: Прогнозирование стоимости автомобилей**

**Описание проекта**

Данный проект посвящен анализу данных и построению модели регрессии для прогнозирования стоимости автомобилей. Проект состоит из трех основных этапов:

1. **Исследовательский анализ данных (EDA) и визуализация**
1. **Обучение модели регрессии**
1. **Создание приложения на FastAPI для предсказаний**
-----
**1. Исследовательский анализ данных (EDA) и визуализация**

**Описание данных**

- **Тренировочный датасет**: 6999 объектов, 12 признаков.
- **Тестовый датасет**: 1000 объектов, 12 признаков.

**Обработка данных**

- **Дубликаты**: В тренировочном датасете было обнаружено 1170 дубликатов. После их удаления осталось 5840 объектов.
- **Пропуски**: В тренировочном датасете были найдены пропуски в следующих колонках:
  - Mileage — 202 пропуска
  - Engine — 202 пропуска
  - Max\_power — 196 пропусков
  - Torque — 203 пропуска
  - Seats — 202 пропуска

В тестовом датасете пропуски обнаружены в тех же колонках, но в меньшем количестве (по 19 пропусков в каждой).

**Преобразование данных**

- Категориальные признаки **mileage**, **engine** и **max\_power** были преобразованы в числовые.
- Признак **torque** был удален из датасета, так как он слабо влияет на стоимость автомобиля и не является значимым для большинства покупателей.
- Для экономии памяти колонки **engine** и **seats** были приведены к типу **int**.

**Выбросы и аномалии**

- Были обнаружены аномальные значения:
  - Пробег со значениями 1,500,000 и 2,360,457 км.
  - Топливная эффективность (**mileage**) со значением 0.
  - Мощность (**max\_power**) со значением 0.

Все аномальные данные были исключены из датасета.

**Визуализация**

- На основе парных диаграмм была выявлена корреляция целевой переменной (**selling\_price**) с признаками **year**, **km\_driven**, **engine** и **max\_power**.
- Тепловая карта корреляции Пирсона подтвердила следующие гипотезы:
  - Признаки **engine** и **year** слабо коррелируют между собой.
  - Сильная положительная линейная зависимость наблюдается между:
    - **selling\_price** и **max\_power**
    - **max\_power** и **engine**
    - **seats** и **engine**
    - **selling\_price** и **year**
    - **selling\_price** и **engine**
  - Обратная зависимость между **km\_driven** и **year** (коэффициент корреляции -0.44).
-----
**2. Обучение модели регрессии**

**Результаты обучения**

- После обучения классической линейной регрессии с параметрами по умолчанию были получены следующие метрики:
  - **Тренировочный датасет**:
    - MSE = 108955192317.84
    - R² = 0.60
  - **Тестовый датасет**:
    - MSE = 235192262956.639
    - R² = 0.59

**Анализ результатов**

1. Средняя цена автомобиля (**selling\_price**) составляет примерно 570,000. MSE – это RMSE в квадрате. Ошибка MSE (RMSE = 484,966) значительна по сравнению со средней ценой.
1. Разница между MSE\_train и MSE\_test почти в два раза, что может быть связано с наличием выбросов в тестовых данных.
1. Значение R² = 0.59 указывает на среднее качество модели, но отсутствие переобучения (R² одинаков для тренировочного и тестового датасетов).

**Улучшение модели**

- После кодирования категориальных признаков с помощью **OneHotEncoder** и повторного обучения модели, ошибка MSE значительно уменьшилась:
  - **Тренировочный датасет**:
    - MSE = 59378030416.027664
    - R² = 0.59
  - **Тестовый датасет**:
    - MSE = 120314790156.17291
    - R² = 0.57

**Бизнес-метрика**

- Модель **model\_cat\_oh**, обученная с использованием кодирования категориальных признаков, показала наилучшие результаты с точки зрения бизнеса. Доля прогнозов, отличающихся от реальных цен не более чем на 10%, составила 29%.
-----
**3. Создание приложения FastAPI для предсказаний**

**Описание приложения**

- Основной модуль приложения — **server.py**, который содержит реализацию следующих эндпоинтов:
  - **fit** — обучение модели.
  - **predict\_item** — предсказание для одного объекта.
  - **predict\_items** — предсказание для множества объектов.
- Модели данных (**Item**, **Items**, **FitResponse**) также реализованы в этом модуле.

**Обучение и сохранение модели**

- Функции и пайплайны для обучения модели находятся в модуле **pipeline.py** (папка **train\_core**).
- Обученная модель сохраняется в файл **models\_train.pickle**.

**Результаты предсказаний**

- После выполнения эндпоинта **predict\_items** результаты предсказаний записываются в файл **predict.csv**.
-----
**Демонстрация работы сервиса**

Для наглядной демонстрации работы приложения доступно [видео](https://drive.google.com/file/d/1ax5vRCJyILCIBMyW7cDQdttocvXVsiHD/view?usp=drive_link).

-----
**Заключение**

Проект успешно завершен, и модель готова к использованию для прогнозирования стоимости автомобилей. Все способы регуляризации не привели к улучшению метрики. Однако кодирование категориальных признаков и использование в модели обучение привели к значительным улучшениям MSE и R².   Приложение на FastAPI позволяет легко интегрировать модель в бизнес-процессы и получать предсказания в реальном времени.

